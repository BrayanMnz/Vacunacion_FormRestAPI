<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Cita de vacunaci&oacute;n</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="colorlib.com" />
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
    <!-- MATERIAL DESIGN ICONIC FONT -->
    <link
      rel="stylesheet"
      href="fonts/material-design-iconic-font/css/material-design-iconic-font.css"
    />

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox-gl-js/v1.8.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.8.0/mapbox-gl.css' rel='stylesheet' />

<script src="https://tiles.locationiq.com/v3/libs/gl-geocoder/4.5.1/locationiq-gl-geocoder.min.js?v=0.2.3"></script>
<link rel="stylesheet" href="https://tiles.locationiq.com/v3/libs/gl-geocoder/4.5.1/locationiq-gl-geocoder.css?v=0.2.3" type="text/css" />

<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

    <!-- STYLE CSS -->
    <link rel="stylesheet" href="css/style.css" />

<style> 
  .modal-dialog {
      width: 100% !important;
      height: 100% !important;
      margin: 0;
      padding: 0;
    }
    
    .modal-content {
      height: auto;
      min-height: 70%;
      min-width: 100%;
      border-radius: 0;
      margin: 1px;
    }
  
    .marker {
              display: block;
              border: none;
              cursor: pointer;
              padding: 0;
              width: 50px;
              height: 50px;
              color: red;
  
          }
  
          .coordinates {
              background: rgba(0, 0, 0, 0.7);
              color: #fff;
              position: absolute;
              bottom: 40px;
              left: 10px;
              padding: 5px 10px;
              margin: 0;
              font-size: 14px;
              line-height: 18px;
              border-radius: 3px;
              display: none;
          }
  /* body {
      margin: 0;
      padding: 0;
  } */
  
  /* #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 400px;
      height: 500px;
  } */
  </style>
  
  </head>
  <body>
    <pre id="coordinates" class="coordinates"></pre>
    <div class="wrapper">
      <div class="image-holder">
        <img src="images/vaccine_1.png" alt="" />
      </div>
      <form action="">
        <div id="wizard">
          <!-- SECTION 1 -->
          <h4></h4>
          <section>
            <div class="form-row">
              <div class="form-holder">
                <label for=""> Documento de Identificaci&oacute;n: </label>
                <input
                  type="text"
                  id="id_persona"
                  name="id_persona"
                  placeholder="000-0000000-0"
                  class="form-control"
                  required
                  pattern="^[0-9]{3}-?[0-9]{7}-?[0-9]{1}$"
				  
                />
              </div>
            </div>
            <div class="form-row">
              <label for=""> Nombre Completo </label>
              <input
                type="text"
                id="nombreCompleto"
                name="nombreCompleto"
                placeholder="Brayan Mu&nacute;oz V."
                class="form-control"
              />
            </div>
            <div class="form-row">
              <label for=""> Fecha Nacimiento </label>
            </div>
              <div class="form-holder">
                <input
                  type="date"
                  id="fechaNacimiento"
                  name="fechaNacimiento"
                  class="form-control"
                  value="2000-01-01"
                  min="1900-01-01"
                  max="2021-12-31"
                /><br />

                <!-- <i class="zmdi zmdi-caret-down"></i> -->
              
            </div>
            <div class="form-row">
              <label for=""> Sexo </label>
              <select id="sexoPersona" name="sexoPersona" class="form-control">
                <option value="M" class="option">Masculino</option>
                <option value="F" class="option">Femenino</option>
                <i class="zmdi zmdi-caret-down"></i>
              </select>
            </div>

            <h2>M&eacute;todo para recibir encuesta de seguimiento:</h2>
            <br />
            <select id="encuesta" name="encuesta" class="form-control" required>
              <option value="false" class="option">V&iacute;a Web</option>
              <option value="true" class="option">
                V&iacute;a Tel&eacute;fono
              </option>
              <i class="zmdi zmdi-caret-down"></i>
            </select>
          </section>

          <!-- SECTION 2 -->
          <h4></h4>
          <section>
            <div class="form-row">
              <label for=""> Correo Electr&oacute;nico </label>
              <input
                type="email"
                id="emailPersona"
                name="emailPersona"
                placeholder="brayanmnz@hotmail.com"
                class="form-control"
              />
            </div>
            <div class="form-row">
              <label for=""> Tel&eacute;fono </label>
              <input
                type="tel"
                id="telefonoPersona"
                name="telefonoPersona"
                pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
                placeholder="000-000-0000"
                required
                class="form-control"
              />
            </div>
            <div class="form-row">
              <div class="form-holder">
                <label for=""> M&oacute;vil </label>
                <input
                  type="tel"
                  id="movilPersona"
                  name="movilPersona"
                  pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
                  placeholder="000-000-0000"
                  required
                  class="form-control"
                />
              </div>
            </div>

            <hr class="solid" />

            <h2>Contacto de Emergencia</h2>
            <br />
            <div class="form-row" style="margin-bottom: 18px">
              <label for=""> Nombre Completo </label>
              <input
                type="text"
                name="nombreContacto"
                id="nombreContacto"
                placeholder="Brayan Mu&nacute;oz"
                class="form-control"
              />
            </div>

            <div class="form-row" style="margin-bottom: 18px">
              <label for=""> Tel&eacute;fono </label>
              <input
                type="tel"
                id="telefonoContacto"
                name="telefonoContacto"
                pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
                placeholder="000-000-0000"
                required
                class="form-control"
              />
            </div>

          </section>

          <!-- SECTION 3 -->
          <h4></h4>
          <section>
            <br />
            <hr />
            <br />
            <div class="form-row">
              <div class="form-holder">
              <div class="form-group row">
                <div class="col-sm-8 mb-3 mb-sm-0">
                    <input type="text" class="form-control form-control-user"
                        id="ubicacionCentro" placeholder="Ubicaci&oacute;n del Centro" disabled>

                        <input type="text" class="" form="RegistrarCentro"
                        id="latitud" name="latitud" placeholder="Ubicaci&oacute;n del Centro"  hidden>

                        <input type="text" class="" name="longitud" form="RegistrarCentro"
                        id="longitud" placeholder=""  hidden>
                </div>
                <div class="col-sm-4">
                    <a onclick="setearLocalizacion()" class="btn btn-danger btn-user btn-block" data-toggle="modal" data-target="#exampleModal">
                        Seleccionar
                    </a>
                </div>
            </div>
              </div>
            </div>
          </section>

          <!-- SECTION 4 -->
          <h4></h4>
          <section>
            <div class="checkbox-circle">
              <label class="active">
                <input type="radio" name="afeccion" value="1" />Cancer
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="2" />Enfermedad renal
                cr&oacute;nica
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="3" />Enfermedades
                pulmonares cr&oacute;nicas
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="4" />Demencia,
                Alzheimer u Otras afecciones neurol&oacute;gicas
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="5" />Diabetes tipo 1
                o Diabetes tipo 2
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="6" />
                S&iacute;ndrome de Down
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="7" />
                Insuficiencia cardiaca, Miocardiopat&iacute;as,
                hipertensi&oacute;n
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="8" />
                VIH
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="9" />
                Sistema inmunitario debilitado
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="10" />
                Enfermedad hep&aacute;tica
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="11" />
                Sobrepeso y obesidad
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="12" />
                Embarazo
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="13" />
                Consumo de tabaco
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="14" />
                Trasplante de &oacute;rganos o Trasplante de c&eacute;lulas
                madre
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="15" />
                Accidente o enfermedad cerebrovascular
                <span class="checkmark"></span>
                <div class="tooltip"></div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="16" />
                Uso de sustancias
                <span class="checkmark"></span>
                <div class="tooltip">
                  Trastornos por el uso de alcohol, opioides o coca&iacute;na
                </div>
              </label>
              <label>
                <input type="radio" name="afeccion" value="17" />
                Ninguna de las anteriores
                <span class="checkmark"></span>
                <div class="tooltip">Estado de salud estable.</div>
              </label>
            </div>
          </section>
        </div>

      </form>
    </div>




  <!-- Modal -->
  <div class="modal fade bottom" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-full-height modal-dialog-centered modal-bottom w-50 mx-auto" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ubicaci&oacute;n de su Domicilio</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="map">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">Guardar</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Script para obtener ubicación.   -->


  <script> 

    var id, cantidad = 0;
    
    var opcionesGPS = {
        enableHighAccuracy: true,
        timeout: 1000,
        maximumAge: 0
    }
    
    
    // $(document).ready(setearLocalizacion());
    
    function setearLocalizacion() {
    
    
    
     //Add your LocationIQ Maps Access Token here (not the API token!)
     locationiqKey = 'pk.7f0e86d94a7ca47518d03b78918b8d2f';
        
        var coordinates = document.getElementById('coordinates');
        
        //Define the map and configure the map's theme
    
        console.log(document.querySelector("#latitud").value);
        console.log(document.querySelector("#longitud").value);
         
    
        var map = new mapboxgl.Map({
            container: 'map',
            center: [-70.69774519746171,  19.48207554529158], 
            style: 'https://tiles.locationiq.com/v3/streets/vector.json?key='+locationiqKey,
            zoom: 12,
            
            
        });
            
        // First create DOM element for the marker
        var el = document.createElement('div');
        el.className = 'marker';
        el.id = 'marker';
        // Set marker properties using JS
        el.style.backgroundImage = 'url(map-marker-icon.png)';
    
        
    
        //Obteniendo la referencia directa.
        navigator.geolocation.getCurrentPosition(
        function(geodata){
            var coordenadas = geodata.coords;
    
    
    
            var marker = new mapboxgl.Marker(el, {
            draggable: true
        }).setLngLat([coordenadas.longitude, coordenadas.latitude])
          .addTo(map);
          
        // After the mouse is released the following function is executed which updates the displayed lat and long
        function onDragEnd() {
            var lngLat = marker.getLngLat();
            coordinates.style.display = 'block';
            coordinates.innerHTML =
                'Latitude: ' + lngLat.lat + '<br />Longitude: ' + lngLat.lng;
            console.log(lngLat.lat + ' '+lngLat.lng);
            document.querySelector("#latitud").value = lngLat.lat;
            document.getElementById("longitud").value = lngLat.lng;
            document.getElementById("ubicacionCentro").value = lngLat.lat + ', '+lngLat.lng;
        }
    
        marker.on('dragend', onDragEnd);
    
            // document.getElementById("ubicacionCentro").value = coordenadas.latitude + ', '+coordenadas.longitude;
            // document.querySelector("#latitud").value = coordenadas.latitude;
            // document.getElementById("longitud").value = coordenadas.longitude;
        }, 
    
        function(){
            document.querySelector("#ubicacionCentro").value = "Error al obtener la ubicación. Codigo: "+error.code+", mensaje: "+error.message;
            alert("Error al obtener la ubicación, Recargue la página");
            // document.querySelector("#longitud").value = "Error al obtener la ubicación";
        }, 
        opcionesGPS);
    
        //Obteniendo el cambio de referencia.
        id = navigator.geolocation.watchPosition(
    
        async function(geodata){
            var coordenadas = geodata.coords;
    
    
    
            var marker = new mapboxgl.Marker(el, {
            draggable: true
        }).setLngLat([coordenadas.longitude, coordenadas.latitude])
          .addTo(map);
          
        // After the mouse is released the following function is executed which updates the displayed lat and long
        function onDragEnd() {
            var lngLat = marker.getLngLat();
            coordinates.style.display = 'block';
            coordinates.innerHTML =
                'Latitude: ' + lngLat.lat + '<br />Longitude: ' + lngLat.lng;
            console.log(lngLat.lat + ' '+lngLat.lng);
            document.querySelector("#latitud").value = lngLat.lat;
            document.getElementById("longitud").value = lngLat.lng;
            document.getElementById("ubicacionCentro").value = lngLat.lat + ', '+lngLat.lng;
        }
    
        marker.on('dragend', onDragEnd);
    
            document.getElementById("ubicacionCentro").value = coordenadas.latitude + ', '+coordenadas.longitude;
            // document.querySelector("#latitud").value = coordenadas.latitude;
            // document.getElementById("longitud").value = coordenadas.longitude;
            
            cantidad++;
            if(cantidad>=5){
                navigator.geolocation.clearWatch(id);
                console.log("Finalizando la trama")
            }
        },
    
        function(error){
            //recibe un objeto con dos propiedades: code y message.
            document.querySelector("#ubicacionCentro").value = "Error al obtener la ubicación. Codigo: "+error.code+", mensaje: "+error.message;
            alert("Error al obtener la ubicación, Recargue la página");
           
            // document.querySelector("#longitud").value = "Error al obtener la ubicación. Codigo: "+error.code+", mensaje: "+error.message;
        });
    }
    
        </script>
    
    



    <script src="js/jquery-3.3.1.min.js"></script>

    <!-- JQUERY STEP -->
    <script src="js/jquery.steps.js"></script>

    <script src="js/main.js"></script>
    <!-- Template created and distributed by Colorlib -->

    <script>
      // 	var prov = [];
      // 	fetch('http://provinciasrd.raydelto.org/provincias')
      // 	.then((resp) => resp.json())
      // 	.then(function(data) {
      //   	// var provincias = data;
      // 	//   console.log(provincias.data[0].nombre);
      // 	//   console.log(provincias.data[0].codigo);
      // 	let select = document.querySelector("#provincia")
      // 	let auxOption = document.createElement("option");
      //         auxOption.selected = "selected";
      //         auxOption.text = "Provincias";
      //         auxOption.value = "Provincia";
      //         select.appendChild(auxOption);
      // 	for (let i =0; i<data.data.length; i++){
      // 	  let option = document.createElement("option");
      // 	  option.text = data.data[i].nombre;
      // 	  option.value = data.data[i].codigo;
      // 	  select.appendChild(option);
      // 	//   prov.push({
      // 	// 	"codigo":  data.data[i].codigo,
      // 	// 	"nombre":  data.data[i].nombre
      // 	//   })
      // 	}

      // })
      // .catch(function(error) {
      //   console.log(error);
      // });

      function cargarMunicipios() {
        var provincia = document.getElementById("provincia").value;

        var municipios = [];
        fetch(
          `http://provinciasrd.raydelto.org/provincias/${provincia}/municipios`
        )
          .then((resp) => resp.json())
          .then(function (data) {
            document.getElementById("municipios").options.length = 0;
            let select = document.querySelector("#municipios");
            let auxOption = document.createElement("option");
            auxOption.selected = "selected";
            auxOption.text = "Municipios";
            auxOption.value = "Municipios";
            select.appendChild(auxOption);
            for (let i = 0; i < data.data.length; i++) {
              let option = document.createElement("option");
              option.text = data.data[i].nombre;
              option.value = data.data[i].codigo;
              select.appendChild(option);
            }
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      function cargarDistritos() {
        var municipio = document.getElementById("municipios").value;

        fetch(
          `http://provinciasrd.raydelto.org/municipios/${municipio}/distritos_municipales`
        )
          .then((resp) => resp.json())
          .then(function (data) {
            document.getElementById("distmunicipal").options.length = 0;
            let select = document.querySelector("#distmunicipal");
            let auxOption = document.createElement("option");
            auxOption.selected = "selected";
            auxOption.text = "Distritos";
            auxOption.value = "Distrito";
            select.appendChild(auxOption);
            for (let i = 0; i < data.data.length; i++) {
              let option = document.createElement("option");
              option.text = data.data[i].nombre;
              option.value = data.data[i].codigo;
              select.appendChild(option);
            }
          })
          .catch(function (error) {
            console.log(error);
          });
      }
    </script>

    <script>
      if (document.getElementById("sendButtonCreate") != null) {
        document
          .getElementById("sendButtonCreate")
          .addEventListener("click", function (event) {
            event.preventDefault();
            let form = {
              descripcion_Formulario: "Probando desde cliente",
              dni_persona: document.getElementById("id_persona").value,
              nombreCompleto_persona:
                document.getElementById("nombreCompleto").value,
              fechaNacimiento_persona:
                document.getElementById("fechaNacimiento").value,
              sexo_persona: document.getElementById("sexoPersona").value,
              email_contacto: document.getElementById("emailPersona").value,
              telefono_contacto:
                document.getElementById("telefonoPersona").value,
              movil_contacto: document.getElementById("movilPersona").value,
              nombreContactoEmergencia:
                document.getElementById("nombreContacto").value,
              telefonoContactoEmergencia:
                document.getElementById("telefonoContacto").value,
              // "provincia": document.getElementById("provincia").value,
              // "municipio": document.getElementById("municipios").value,
              // "sector": document.getElementById("distmunicipal").value,
              latitud: document.getElementById("latitud").value,
              longitud: document.getElementById("longitud").value,
              afeccion: document.querySelector('input[name="afeccion"]:checked')
                .value,
              encuesta: document.getElementById("encuesta").value,
            };

            let url = 'https://app.brayanmnz.live/api/formulario/';
            // const token = localStorage.getItem('token');

            fetch(url, {
              method: "POST", // or 'PUT'
              body: JSON.stringify(form), // data can be `string` or {object}!
              headers: {
                "Content-Type": "application/json",
              },
            })
              .then((res) => res.json())
              .catch((error) => {
                console.error("Error:", error);
              })
              .then((response) => {
                console.log("response.status:" + response.status);
                console.log("response.ok:" + response.ok);

                console.log("Success:", response);
                if (response != undefined) {
                  alert("El formulario ha sido guardado exitosamente.");
                }
                window.location.href = "/";
              });
          });
      }
    </script>


  </body>
</html>
